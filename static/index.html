<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#6441a5">
    <meta name="msapplication-TileColor" content="#6441a5">
    <meta name="theme-color" content="#6441a5">

    <meta property="og:title" content="Join streamers with no audience">
    <meta property="og:site_name" content="LonelyRaids">
    <meta property="og:url" content="https://lonelyraids.com/">
    <meta property="og:description" content="Make the day by filling the audience of a lonely streamer broadcasting to zero viewers">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://lonelyraids.com/og.png">

    <meta name="title" content="LonelyRaids -- Lonely Streams with No Audience">
    <meta name="description" content="Become the entire audience of a lonely streamer broadcasting to zero viewers">
    <meta name="keywords" content="stream, no viewers stream, streams with no audience, twitch no viewers">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <meta name="author" content="Tyler Benson">

    <title>LonelyRaids | collectively joining lonely streams with zero viewers</title>
    <link rel="stylesheet" href="styles.css" type="text/css">
  </head>
  <body>
    <div id="page-container">
      <div id="content-wrap">
    <div class="grid-container">
      <div class="intro-text">
        <h1>lonelyraids</h1>
        <p>collectively joining streams with zero viewers</p>
      </div>
      <!--
      <div class="refresh">
        <button id="new-streamer-button" disabled>please wait...</button>
      </div> -->


      <div class="join-raid-div">
        <button id="join-raid-button" disabled>please wait...</button>

        <span id="refresh-raid-button" class="cursor-text">refresh raids</span>
      </div>
    </div>


    <div id="twitch-embed" class="container" style="display: none;"></div>
  </div>
    <div id="footer">
      this stream had zero viewers as of <span id="stream-zero-time"></span> seconds ago
      <br><br>
      last five streams watched: <span id="stream-list"></span>
      <br><br>
      <a href="https://github.com/tybens/lonelyraids.com" target="_blank" rel="noopener">open source</a> made by tyler benson, forked from the great jack kingsman's <i>Nobody.live</i>
    </div>
  </div>

    <script src="https://embed.twitch.tv/embed/v1.js"></script>
    <script type="text/javascript">
      let server =  window.location.hostname === '127.0.0.1' ? 'http://127.0.0.1:5000':'https://lonelyraids.com';
      var counting = false;
      var raidStream;
      const raidButton = document.getElementById('join-raid-button');
      const refreshButton = document.getElementById('refresh-raid-button');
      raidButton.disabled = false;
      raidButton.innerText = 'start raid';

      function displayStream(stream) {
        // clear and rerender the embed div
        document.getElementById('twitch-embed').innerHTML = '';
        document.getElementById('twitch-embed').style.display = '';
        new Twitch.Embed('twitch-embed', {
          width: '100%',
          channel: stream.user_name,
          theme: 'dark',
          parent: ['lonelyraids.com']
        });

        document.getElementById('stream-zero-time').innerText = (Math.round(new Date().getTime() / 1000  - stream.fetched));

        // load and append stream to historical streams
        let usernames = JSON.parse(localStorage.getItem('streamHistoryJSON')) || [];
        usernames.push(stream.user_name);
        let trimmedUsernames = usernames.slice(-5);
        localStorage.setItem('streamHistoryJSON', JSON.stringify(trimmedUsernames));

        // render list
        document.getElementById('stream-list').innerHTML = trimmedUsernames.map(username => {
          let a = document.createElement('a');
          var linkText = document.createTextNode(username);
          a.appendChild(linkText);
          a.href = 'https://www.twitch.tv/' + username;
          a.target = '_blank'
          a.rel = 'noopener';

          return a.outerHTML;
        }).join(', ');
      }

      function str_pad_left(string,pad,length) {
        return (new Array(length+1).join(pad)+string).slice(-length);
      }

        /*Countdown script*/
      async function countdown(counter) {
        counting = true
         // 3 minutes
        var interval = setInterval(function() {
          counter--;
          if (counter == 0) {
            clearInterval(interval);
            counting = false;
            raidButton.innerText = 'start raid'

          } else {
            var minutes = Math.floor(counter / 60);
            var seconds = counter % 60;
            var countdownStr = str_pad_left(minutes,'0',2)+':'+str_pad_left(seconds,'0',2);
            raidButton.innerText = "join started raid " + countdownStr;
          };
        }, 1000);
      };
          
      async function getCountdown() {
        fetch(`${server}/countdown`).then(response => response.json())
          .then(counter => {
            console.log(counter)
            if ((!counting) && (counter.countdown!= 0)) {
              countdown(counter.countdown);

            } else {
              raidButton.innerText = 'start raid'
            };
          }).catch((error) => {
            console.error('Error:', error);
          });
      }


      async function getRaid() {
        // very convulated way of changing button location after first press
        raidButton.parentNode.className = "refresh";
        raidButton.style.margin = '0';
        raidButton.style.padding = '10px 20px';
        raidButton.style.fontSize = '18px';
        refreshButton.style.fontSize = '12px';
        refreshButton.style.padding = '10px';
        fetch(`${server}/streamraid`).then(response => response.json())
          .then(stream => {
            // when getRaid is called and we aren't counting start raid

            raidStream = stream;
            displayStream(raidStream);

        
            getCountdown()

          }).catch((error) => {
            console.error('Error:', error);
          });
        }


      // TODO: Allow users to browse random streams until starting a raid on a specific one
      // document.getElementById('new-streamer-button').addEventListener('click', fetchAndRenderRandomStream); 
      raidButton.addEventListener('click', getRaid)
      refreshButton.addEventListener('click', getCountdown)

      window.onload = getCountdown(); // issue get countdown upon loading the page

    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7JF3B0HFYJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7JF3B0HFYJ');
    </script>
  </body>
</html>
